Timekeeper helps Java/Groovy test codes to record performance measurement statistics, and to compile reports in Markdown format.

== Motivation

Often I develop Web UI tests in Groovy using Selenium. I wanted to measure the performance of the tests. Often I want to measure:

1. how long (seconds) tests take to navigate to a URL in browser
2. how long tests take to take and save screenshot of a web page
3. how large (bytes) is the generated image file

I want to examine many URLs; 100 or more. In practice, most of URLs respond within 3 seconds but a few of them sometimes respond slow (over 20 seconds). Why? What happened? I need to list the slow URLs and look into them.

The 1st problem is that it is bothersome recording the duration with a stopwatch. So I introduced the Apache Commonns https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/time/StopWatch.html[StopWatch] library to measure the duration and print the figure in console messages. Still, it is difficult to find useful information out of bulky console messages. So I want to summerise the staticstics. The 2nd problem is that it is too tiresome to write a statistics report in Markdown table format manually. I want to automate this task.

I want my WebUI tests to perform not only performance measurement but also compiling a concise report in Markdown format as well. Here comes the Timekeeper!

== API

Javadoc is link:./api/index.html[here]

== Examples

A `Timekeeper` object lets you create **one or more** `Measurement` objects. A `Measurement` object stands for a table which contains a header and one or more `Record` set. A `Record` contains columns and a duration in `mm:ss` format (minutes:seconds). My test will put an instance of `LocalDateTime.now()` just before the test calls a long running method call (such as Selenium navite, and taking screenshot). This timestatmp is recorded as `startAt`. Also my test will put another instance of `LocalDateTime.now()` just after the long-running method call. This timestamp is recorded `endAt`. Each record object can calculate the duration = endAt minus startAt. And finally Timekeeper's `report(Path)` method can generate a text report in Markdown syntax.


=== Example 1 --- minimalistic

The following example is a minimalistic example of utilizing the Timekeeper library, in Groovy using JUnit 5.

[code]
----
include::../src/test/groovy/com/kazurayam/timekeeper/demo/TimeKeeperDemoMinimal.groovy[]
----

This code outputs the following markdown text.

[code]
----
## How long it waited

|description m1|duration|graph|
|:----|----:|:----|
|sleeping for 2 secs|00:02|`#`|
|sleeping for 3 secs|00:03|`#`|
|sleeping for 5 secs|00:05|`#`|
|sleeping for 7 secs|00:07|`#`|
|Average|00:04|

The format of duration is "minutes:seconds"

one # represents 10 seconds in the duration graph
----

=== Example2 --- HTTP GET & save HTML

The following code processes a list URLs. It makes HTTP GET request, save the request body into file. It checks the size of the file in bytes, and measures the duration of HTTP GET request.

[code]
----
include::../src/test/groovy/com/kazurayam/timekeeper/demo/TimekeeperDemoHttpInteraction.groovy[lines=1..95]
----

This code will output the following markdown text.

[code]
----
include::./TimekeeperDemoHttpInteraction/report.md[lines=1..12]
----

=== Example 3 --- Selenium test

Input CSV file is here:

----
include::../src/test/fixtures/URLs.csv[]
----

The test emits the following Markdown text:

[code]
----
## How long it took to navigate to URLs

|URL|duration|graph|
|:----|----:|:----|
|https://www.google.com/search?q=timekeeper|00:02|`#`|
|https://duckduckgo.com/?q=timekeeper&t=h_&ia=web|00:02|`#`|
|https://search.yahoo.co.jp/search?p=timekeeper|00:03|`#`|
|Average|00:02|

The format of duration is "minutes:seconds"

one # represents 10 seconds in the duration graph

## How long it took to take shootshots

|URL|size|duration|graph|
|:----|----:|----:|:----|
|https://www.google.com/search?q=timekeeper|510,456|00:05|`#`|
|https://duckduckgo.com/?q=timekeeper&t=h_&ia=web|272,954|00:03|`#`|
|https://search.yahoo.co.jp/search?p=timekeeper|381,088|00:03|`#`|
|Average|388,166|00:04|
----

This Markdown text will be rendered on browser like this:

image::images/report.png[]


The code is here:
----
include::../src/test/groovy/com/kazurayam/timekeeper/demo/TimeKeeperDemoWithSelenium.groovy[]
----

== Sorting rows in table

As soon as you get a table generated by Timekeeper, you would feel like to sort it for better readability. Timekeeper is capable of it. Timekeeper supports sorting rows by multiple selected keys. It is possible to sort rows in either of ascending and descending order.

A few examples down here.

Here I use a term "Attributes" to categorise the column names such as "Case", "URL". "Attributes" does not include the recorded figures: size and duration.

You can find a sample code at

* link:../src/test/groovy/com/kazurayam/timekeeper/demo/TimekeeperDemoHttpInteraction.groovy[]

=== Table sorted by Attributes

The sample code has this method:

```
include::../src/test/groovy/com/kazurayam/timekeeper/demo/TimekeeperDemoHttpInteraction.groovy[lines=103..115]
```

Please note the following fragment:

```
            .sortByAttributes()
```

This fragment specifies Timekeeper to sort the rows by all Attributes of the table. If you have 2 or more attributes in the table, the left column has higher sorting priority than its right. In this example, the sorting key is : "Case" > "URL".

Rows are sorted in ascending order unless the order is explicitly specified.

The output looks like this:

```
include::./TimekeeperDemoHttpInteraction/sortByAttributes.md[lines=1..12]
```

=== Table sorted by Attributes, descending order

You can sort in descending order.

```
include::../src/test/groovy/com/kazurayam/timekeeper/demo/TimekeeperDemoHttpInteraction.groovy[lines=131..143]
```

Please note this fragment where you specify the descending order.

```
    .sortByAttributes(Measurement.ROW_ORDER.DESCENDING).

```

The output looks like this:
```
include::./TimekeeperDemoHttpInteraction/sortByAttributes_descending.md[lines=1..12]
```


=== Table sorted by selected items among Attributes

You can choose columns out of the Attributes.

```
include::../src/test/groovy/com/kazurayam/timekeeper/demo/TimekeeperDemoHttpInteraction.groovy[lines=117..129]
```

Please note the following fragment:

```
Measurement interactions = new Measurement.Builder(
    "get URL, save HTML into file",
    ["Case", "URL"])
                .sortByAttributes(["URL"]).
                build();
```

The table has 2 attributes "Case" and "URL". And you selected "URL" as the sort key.

The output will look like this:

```
include::./TimekeeperDemoHttpInteraction/sortByAttributes_URL.md[lines=1..12]
```

=== Table sorted by Duration

You can sort rows by duration.

```
include::../src/test/groovy/com/kazurayam/timekeeper/demo/TimekeeperDemoHttpInteraction.groovy[lines=159..171]
```

The output is like this:

```
include::./TimekeeperDemoHttpInteraction/sortByDuration_descending.md[lines=1..12]
```


=== Table sorted by Attributes, then by duration

You can sort rows by Attributes first, the by duration. Perhaps this sorting condition is most useful.

```
include::../src/test/groovy/com/kazurayam/timekeeper/demo/TimekeeperDemoHttpInteraction.groovy[lines=145..157]
```

The output looks like this:

```
include::./TimekeeperDemoHttpInteraction/sortByAttributesThenDuration.md[lines=1..12]
```

=== Table sorted by Size

You can sort rows by duration.

```
include::../src/test/groovy/com/kazurayam/timekeeper/demo/TimekeeperDemoHttpInteraction.groovy[lines=174..186]
```

The output is like this:

```
include::./TimekeeperDemoHttpInteraction/sortBySize_ascending.md[lines=1..12]
```

=== List of supported `sortBy*()` methods

Please have a look at the source code of

* link:../src/main/java/com/kazurayam/timekeeper/Measurement.java[Measurement.Builder]

to find out full list of `sortBy*()` methods supported.

== Download

The artifact is available at the Maven Central repository:

- https://mvnrepository.com/artifact/com.kazurayam/timekeeper

== Dependencies

Timekeeper was tested on Java8.

See `build.gradle` at https://github.com/kazurayam/timekeeper/ for external dependencies.


== Repository

* https://github.com/kazurayam/timekeeper
